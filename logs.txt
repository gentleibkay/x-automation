
import os
from flask import Flask, render_template, request, redirect, url_for
from storage import list_drafts, approve_draft, publish_draft

app = Flask(__name__, template_folder="templates")
app.config['SECRET_KEY'] = os.getenv("SECRET_KEY", "changeme")

@app.route("/")
def index():
    drafts = list_drafts()
    return render_template("index.html", drafts=drafts)

@app.route("/approve/<int:draft_id>", methods=["POST"])
def approve(draft_id):
    approve_draft(draft_id)
    publish_draft(draft_id)
    return redirect(url_for("index"))

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=int(os.getenv("PORT", 10000)))